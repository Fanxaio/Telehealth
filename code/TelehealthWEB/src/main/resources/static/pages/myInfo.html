<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>我的时间</title>
    <link rel="icon" href="../assets/images/favicon2.ico"/>
    <link rel="stylesheet" href="../assets/libs/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../assets/common.css" media="all">
</head>

<body>

<div class="layui-fluid">
    <div class="layui-card">

        <!--<div class="layui-card-body layui-upload">-->
            <!--<span style="margin-left: 16px;">用户头像</span>-->
            <!--<input type="file" name="file" id="s_pmt_dw" style="width:190px">-->
            <!--<button type="button" class="layui-btn" id="test9">上传</button>-->
            <!--<div class="layui-upload-list" id="demo2"></div>-->
        <!--</div>-->


        <div class="layui-card-body layui-form">

            <!-- 医生个人信息表单 -->
            <form class="layui-form" lay-filter="docInfoForm">
                <!--<div class="layui-form-item">-->
                    <!--<div class="layui-inline">-->
                        <!--<label class="layui-form-label">头像</label>-->
                        <!--<div class="layui-input-block">-->
                            <!--<img id="head" alt="用户头像" src="javaScript:NextPic()" style="width:240px;height:320px;display:block;">-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">账号</label>
                        <div class="layui-input-block">
                            <input type="text" name="username" lay-verify="required"  class="layui-input">
                            <!--<span id="uName">用户名</span>-->
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">姓名</label>
                        <div class="layui-input-block">
                            <input type="text" name="nickName" lay-verify="required" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">性别</label>
                        <div class="layui-input-block">
                            <input type="radio" name="sex" value="男" title="男" checked/>
                            <input type="radio" name="sex" value="女" title="女"/>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">诊所名称</label>
                        <div class="layui-input-block">
                            <input type="text" name="clinic" lay-verify="required" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">诊所地址</label>
                        <div class="layui-input-block">
                            <input type="text" name="address" lay-verify="required" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">科室</label>
                        <div class="layui-input-block">
                            <input type="text" name="department" lay-verify="required" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">电话</label>
                        <div class="layui-input-block">
                            <input name="phone" placeholder="请输入手机号" type="text" class="layui-input"
                                   lay-verify="required|phone" required/>
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">邮箱</label>
                        <div class="layui-input-block">
                            <input type="email" name="email" lay-verify="required|email" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">个人简介</label>
                        <div class="layui-input-block">
                            <!--<input type="text" name="introduction" lay-verify="required" autocomplete="off" class="layui-input">-->
                            <textarea name="introduction" rows="5" cols="25"></textarea>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item ">
                    <button class="layui-btn layui-btn-primary" type="button" ew-event="closeDialog" >取消</button>
                    <button class="layui-btn" lay-filter="userFormSubmit" lay-submit >保存</button>
                </div>
            </form>
        </div>
        <!--修改按钮 医生修改密码-->
        <div class="layui-btn-container text-right">
            <button class="layui-btn " id="btnPsw">修改密码</button>
        </div>
    </div>
</div>

<!-- 修改密码弹窗 -->
<script type="text/html" id="upModel">
    <form class="layui-form model-form" id="formPsw">
        <div class="layui-form-item">
            <label class="layui-form-label">原始密码:</label>
            <div class="layui-input-block">
                <input type="password" name="oldPsw" placeholder="请输入原始密码" class="layui-input"
                       lay-verType="tips" lay-verify="required" required/>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">新密码:</label>
            <div class="layui-input-block">
                <input type="password" name="newPsw" placeholder="请输入新密码" class="layui-input"
                       lay-verType="tips" lay-verify="required|psw" required/>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">确认密码:</label>
            <div class="layui-input-block">
                <input type="password" name="rePsw" placeholder="请再次输入新密码" class="layui-input"
                       lay-verType="tips" lay-verify="required|repsw" required/>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block text-right">
                <button class="layui-btn layui-btn-primary" type="button" ew-event="closeDialog">取消</button>
                <button class="layui-btn" lay-filter="submitPsw" lay-submit>保存</button>
            </div>
        </div>
    </form>
</script>

<!-- js部分 -->
<script type="text/javascript" src="../assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="../assets/common.js"></script>
<script>
    layui.use(['jquery', 'form', 'table', 'util', 'admin','laydate'], function () {
        var $ = layui.jquery;
        var form = layui.form;
        var table = layui.table;
        var layer = layui.layer;
        var util = layui.util;
        var admin = layui.admin;
        var laydate = layui.laydate;
        // var upload = layui.upload;

        //选完文件后不自动上传（js代码，将文件传到后台）
        // upload.render({
        //     elem: '#s_pmt_dw'				//“选择文件”按钮的ID
        //     ,url: './rest/population/uploadPortrait'	//后台接收地址
        //     ,data: {s_rkbm: '1',type:'S1'}		//传递到后台的数据
        //     ,auto: false				//不自动上传设置
        //     ,accept: 'file'				 //允许上传的文件类型
        //     ,exts: 'png|jpg|bmp' 			//设置智能上传图片格式文件
        //     ,size: 5000 				//最大允许上传的文件大小
        //     ,multiple: true				//设置是否多个文件上传
        //     ,bindAction: '#test9'			//“上传”按钮的ID
        //     ,before: function(obj){
        //         //预读本地文件示例，不支持ie8
        //         obj.preview(function(index, file, result){		//在当前ID为“demo2”的区域显示图片
        //             $('#demo2').append('<img name = "s_pmt_dw" style="width: 120px; height: 150px; margin-left: 16px;" src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img">')
        //         });
        //     }
        //     ,done: function(res){
        //         console.log(res)
        //     }
        // });

        admin.req('doctor/queryDocInfo', {}, function (res) {

            form.val("docInfoForm", {
                username: res.username,
                nickName: res.name,
                sex: res.sex,
                clinic: res.clinic,
                address: res.address,
                department: res.department,
                phone: res.phone,
                email: res.email,
                introduction: res.introduction
            })
        }, 'GET');

        // 修改密码
        $('#btnPsw').click(function () {
            layer.open({
                type: 1,
                title: '修改密码',
                area: '360px',
                offset: '65px',
                content: $('#upModel').html()
            });
        });

        // 监听修改密码表单提交
        form.on('submit(submitPsw)', function (d) {
            layer.load(2);
            admin.req('user/psw', d.field, function (res) {
                if (res.code == 200) {
                    layer.closeAll('loading');
                    layer.closeAll('page');
                    layer.msg(res.msg, {icon: 1, time: 1500}, function () {
                        // location.replace('login.html');
                    });
                } else {
                    layer.closeAll('loading');
                    layer.msg(res.msg, {icon: 2});
                }
            }, 'PUT');
            return false;
        });

        // 添加表单验证方法
        form.verify({
            psw: [/^[\S]{5,12}$/, '密码必须5到12位，且不能出现空格'],
            repsw: function (t) {
                if (t !== $('#formPsw input[name=newPsw]').val()) {
                    return '两次密码输入不一致';
                }
            }
        });

        // 监听修改医生个人信息表单提交
        form.on('submit(userFormSubmit)', function (d) {
            layer.load(2);
            admin.req('doctor/updateDocInfo', d.field, function (res) {
                if (res.code == 200) {
                    layer.closeAll('loading');
                    layer.closeAll('page');
                    layer.msg(res.msg, {icon: 1, time: 1500}, function () {
                        // location.replace('login.html');
                    });
                } else {
                    layer.closeAll('loading');
                    layer.msg(res.msg, {icon: 2});
                }
            }, 'PUT');
            return false;
        });



    });
</script>

</body>
</html>